<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sword Leaderboard - EZ Tiers</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <nav id="navbar">
    <div class="container flex-between">
      <a href="index.html" class="logo gradient-text">EZ Tiers</a>
      <ul class="nav-links">
        <li><a href="sword.html" class="nav-link active">Sword</a></li>
        <li><a href="axe.html" class="nav-link">Axe</a></li>
        <li><a href="crystal.html" class="nav-link">Crystal</a></li>
        <li><a href="bedwars.html" class="nav-link">Bedwars</a></li>
        <li><a href="fireball.html" class="nav-link">Fireball Fight</a></li>
        <li><a href="nethpot.html" class="nav-link">Nethpot</a></li>
        <li><a href="diapot.html" class="nav-link">Diapot</a></li>
      </ul>
    </div>
  </nav>

  <main class="container" style="margin-top: 100px;">
    <h2 class="gradient-text">Sword Leaderboard</h2>
    <table id="leaderboard">
      <thead>
        <tr>
          <th>Player</th>
          <th>Tier</th>
          <th>Score</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <section id="adminSection">
      <h3>Admin Panel</h3>
      <form id="addForm">
        <input type="text" id="playerName" placeholder="Player Name" required />
        <input type="text" id="playerTier" placeholder="Tier (e.g., HT1)" required />
        <input type="number" id="playerScore" placeholder="Score" required />
        <button type="submit">Add Player</button>
      </form>
    </section>
  </main>

  <script>
    <script>
const ADMIN_PIN = "0255";
let isAdmin = false;
let mode = ""; // will be set based on URL or file name

// Extract mode from the file name, e.g. "sword.html" -> "sword"
function detectMode() {
  const path = window.location.pathname;
  const file = path.substring(path.lastIndexOf('/') + 1);
  return file.replace(".html", "").toLowerCase();
}

function requestAdminPin() {
  const inputPin = prompt("Enter Admin PIN:");
  if (inputPin === ADMIN_PIN) {
    isAdmin = true;
    document.getElementById("adminSection").style.display = "block";
  } else {
    alert("Incorrect PIN. Admin controls are hidden.");
    isAdmin = false;
    document.getElementById("adminSection").style.display = "none";
  }
}

function loadLeaderboard() {
  fetch(`/api/leaderboard?mode=${mode}`)
    .then(res => res.json())
    .then(data => {
      const tbody = document.getElementById("leaderboardBody");
      tbody.innerHTML = "";
      data.sort((a, b) => a.tier.localeCompare(b.tier)); // auto-sorting
      data.forEach(player => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${player.name}</td>
          <td>${player.tier}</td>
          ${isAdmin ? `
            <td class="actions">
              <button onclick="editPlayer('${player.name}', '${player.tier}')">Edit</button>
              <button class="delete" onclick="removePlayer('${player.name}')">Delete</button>
            </td>
          ` : ""}
        `;
        tbody.appendChild(row);
      });
    });
}

function addPlayer() {
  const name = document.getElementById("playerName").value.trim();
  const tier = document.getElementById("playerTier").value.trim();
  if (!name || !tier) return alert("Please enter name and tier");

  fetch(`/api/leaderboard`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ name, tier, mode, pin: ADMIN_PIN })
  })
    .then(res => res.json())
    .then(res => {
      alert(res.message || "Player added");
      loadLeaderboard();
    });
}

function editPlayer(name, currentTier) {
  const newTier = prompt(`Enter new tier for ${name}`, currentTier);
  if (newTier) {
    fetch(`/api/leaderboard`, {
      method: 'PUT',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ name, tier: newTier, mode, pin: ADMIN_PIN })
    })
      .then(res => res.json())
      .then(res => {
        alert(res.message || "Player updated");
        loadLeaderboard();
      });
  }
}

function removePlayer(name) {
  if (!confirm(`Remove ${name}?`)) return;
  fetch(`/api/leaderboard`, {
    method: 'DELETE',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ name, mode, pin: ADMIN_PIN })
  })
    .then(res => res.json())
    .then(res => {
      alert(res.message || "Player removed");
      loadLeaderboard();
    });
}

// Navigation logic
function switchMode(target) {
  window.location.href = `${target.toLowerCase()}.html`;
}

// Run on load
window.onload = () => {
  mode = detectMode();
  loadLeaderboard();
  requestAdminPin();
};
</script>

  </script>
</body>
</html>
